# specs/003-portfolio-dashboard/tasks/T-012.md

## Task: Portfolio Notes Component Tests

## Type
unit-test

## Context
- **Phase**: Phase 2 - Test Infrastructure
- **Builds on**: None
- **Blocks**: T-017 (Portfolio Notes Implementation)

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001-auth | frontend/src/auth/useAuth.ts | 001-auth/T-016 | `import { useAuth } from '../auth/useAuth'` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| None | None | None |

## Scope
- **CREATE**: `frontend/src/dashboard/PortfolioNotes.test.tsx`

## Contract
```typescript
// Test suite for PortfolioNotes component
describe('PortfolioNotes', () => {
  test('renders nothing for non-admin users', () => {
    // Mock useAuth to return non-admin user
    // Render component
    // Assert component returns null
  });

  test('renders textarea and save status for admin users', () => {
    // Mock useAuth to return admin user
    // Render component
    // Assert textarea is present with correct attributes
    // Assert save status indicator is present
  });

  test('calls API with debounced autosave on text change', async () => {
    // Mock API client
    // Mock useAuth to return admin user
    // Render component
    // Type in textarea
    // Wait for debounce delay
    // Assert API was called with correct payload
  });

  test('shows saving status during API call', async () => {
    // Mock API client with delayed response
    // Mock useAuth to return admin user
    // Render component
    // Type in textarea
    // Assert "Saving..." status appears
    // Wait for API response
    // Assert "Saved" status appears
  });

  test('shows error status on API failure', async () => {
    // Mock API client to reject
    // Mock useAuth to return admin user
    // Render component
    // Type in textarea
    // Wait for API failure
    // Assert error status is displayed
  });

  test('respects maxLength constraint', () => {
    // Mock useAuth to return admin user
    // Render component
    // Assert textarea has maxLength={10000}
  });

  test('has proper accessibility attributes', () => {
    // Mock useAuth to return admin user
    // Render component
    // Assert textarea has aria-label
    // Assert textarea has aria-describedby pointing to status
    // Assert status has aria-live="polite"
    // Assert region has proper aria-label
  });
});
```

## Logic
1. Import React Testing Library utilities and mocking functions
2. Mock useAuth hook to control user role in tests
3. Mock API client to control autosave behavior
4. Test admin-only visibility with role-based rendering
5. Test textarea attributes and accessibility compliance
6. Test debounced autosave functionality with timing assertions
7. Test save status indicators (saved, saving, error)
8. Test maxLength constraint enforcement
9. Test proper ARIA labels and live regions for screen readers

## Verification
- [ ] All test methods contain assertions or pytest.raises
- [ ] Tests cover admin-only access control
- [ ] Tests verify debounced autosave behavior
- [ ] Tests check accessibility attributes
- [ ] Tests validate error handling
- [ ] Mock implementations are realistic

## LOC Estimate
~120 lines