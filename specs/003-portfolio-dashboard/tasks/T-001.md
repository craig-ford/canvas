# specs/003-portfolio-dashboard/tasks/T-001.md

## Task: Portfolio Service Contract Tests

## Type
contract-test

## Context
- **Phase**: Phase 1 - Contracts & Interfaces
- **Builds on**: None
- **Blocks**: T-003, T-005

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001-auth | backend/canvas/auth/dependencies.py | 001-auth/T-015 | `from canvas.auth.dependencies import get_current_user, require_role` |
| 002-canvas-management | backend/canvas/models/vbu.py | 002-canvas-management/T-003 | `from canvas.models.vbu import VBU` |
| 002-canvas-management | backend/canvas/models/canvas.py | 002-canvas-management/T-003 | `from canvas.models.canvas import Canvas` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| None | None | None |

## Scope
- **CREATE**: `backend/canvas/portfolio/schemas.py`
- **CREATE**: `backend/canvas/portfolio/service.py`
- **CREATE**: `tests/test_portfolio_service.py`

## Contract
```python
# backend/canvas/portfolio/schemas.py
from pydantic import BaseModel, Field
from typing import Optional, List
from uuid import UUID
from datetime import date
from enum import Enum

class LifecycleLane(str, Enum):
    build = "build"
    sell = "sell"
    milk = "milk"
    reframe = "reframe"

class VBUSummary(BaseModel):
    id: UUID
    name: str
    gm_name: str
    lifecycle_lane: LifecycleLane
    success_description: Optional[str]
    currently_testing: Optional[str]
    next_review_date: Optional[date]
    primary_constraint: Optional[str]
    health_indicator: str
    portfolio_notes: Optional[str]

class PortfolioFilters(BaseModel):
    lane: Optional[List[LifecycleLane]] = None
    gm_id: Optional[List[UUID]] = None
    health_status: Optional[List[str]] = None

class PortfolioNotesRequest(BaseModel):
    notes: Optional[str] = Field(None, max_length=10000)

# backend/canvas/portfolio/service.py
from typing import List
from canvas.models.user import User
from .schemas import VBUSummary, PortfolioFilters

class PortfolioService:
    async def get_summary(self, user: User, filters: PortfolioFilters) -> List[VBUSummary]:
        """Get portfolio summary with role-based filtering and health computation"""
        ...
    
    async def update_portfolio_notes(self, notes: str, user: User) -> None:
        """Update portfolio notes (admin only)"""
        ...
```

## Logic
1. Create Pydantic schemas for VBUSummary, PortfolioFilters, PortfolioNotesRequest
2. Define PortfolioService interface with get_summary and update_portfolio_notes methods
3. Write contract tests that verify method signatures and basic behavior expectations
4. Test role-based access control contracts (admin vs GM vs viewer)
5. Test filter parameter validation and enum constraints

## Verification
- [ ] Imports resolve without error
- [ ] Type hints complete
- [ ] Tests pass
- [ ] Contract methods defined with proper signatures
- [ ] Pydantic models validate correctly

## LOC Estimate
~150 lines