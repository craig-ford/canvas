# specs/001A-infrastructure/tasks/T-007.md

## Task: Database Implementation

## Type
implementation

## Context
- **Phase**: Phase 3: Data Layer
- **Builds on**: T-003 (Database Contract Tests), T-006 (Backend Core Implementation)
- **Blocks**: T-010 (Docker Compose Setup), T-012 (Seed Script Implementation)
- **Requirements**: FR-INFRA-007, FR-INFRA-009

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-003 | tests/test_db.py | get_db_session from db.py |
| T-006 | backend/canvas/config.py | Settings class |

## Scope
- **CREATE**: `backend/canvas/db.py`
- **CREATE**: `backend/alembic.ini`

## Contract
```python
# db.py
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from canvas.config import Settings

settings = Settings()
engine = create_async_engine(settings.database_url)
AsyncSessionLocal = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

async def get_db_session() -> AsyncSession:
    """Get database session for dependency injection."""
    ...
```

## Logic
1. Import SQLAlchemy async components and Settings
2. Create async engine from database_url
3. Create async session factory with proper configuration
4. Implement get_db_session async generator for FastAPI dependency
5. Create alembic.ini with async configuration pointing to database_url

## Verification
- [ ] Async engine created with database_url from settings
- [ ] AsyncSessionLocal configured with expire_on_commit=False
- [ ] get_db_session yields session and closes properly
- [ ] alembic.ini has async driver configuration
- [ ] All imports resolve without error

## LOC Estimate
~30 lines