# specs/001A-infrastructure/tasks/T-003.md

## Task: Database Contract Tests

## Type
contract-test

## Context
- **Phase**: Contracts & Interfaces
- **Builds on**: None
- **Blocks**: T-007 (Database Implementation)

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|

## Scope
- **CREATE**: `backend/tests/test_db_contract.py`

## Contract
```python
# Async database session factory
async def get_db_session() -> AsyncGenerator[AsyncSession, None]:
    """Yields async database session with automatic cleanup"""
    ...

# Async engine creation
def create_async_engine(database_url: str) -> AsyncEngine:
    """Creates async SQLAlchemy engine with asyncpg driver"""
    ...
```

## Logic
1. Create test_db_contract.py with database interface tests
2. Test get_db_session function exists and returns AsyncGenerator
3. Test get_db_session yields AsyncSession instance
4. Test create_async_engine function exists and returns AsyncEngine
5. Test create_async_engine accepts database_url string parameter
6. Test async session can execute simple query (SELECT 1)
7. Test session cleanup happens automatically

## Verification
- [ ] test_get_db_session_exists() asserts function exists
- [ ] test_get_db_session_returns_generator() asserts AsyncGenerator return type
- [ ] test_get_db_session_yields_session() asserts AsyncSession instance
- [ ] test_create_async_engine_exists() asserts function exists
- [ ] test_create_async_engine_returns_engine() asserts AsyncEngine return type
- [ ] test_session_can_execute_query() asserts SELECT 1 works
- [ ] test_session_cleanup() asserts session closes properly

## LOC Estimate
~45 lines