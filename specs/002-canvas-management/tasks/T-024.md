# specs/002-canvas-management/tasks/T-024.md

## Task: Canvas Page Integration

## Type
implementation

## Context
- **Phase**: Phase 6 (UI)
- **Builds on**: T-022 (CanvasPage), T-023 (Canvas API Client)
- **Blocks**: T-025 (App Routing Integration)

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-022 | frontend/src/canvas/CanvasPage.tsx | CanvasPage component |
| T-023 | frontend/src/api/canvasClient.ts | Canvas API client methods |

## Scope
- **CREATE**: `frontend/src/canvas/hooks/useCanvas.ts`

## Contract
```typescript
interface UseCanvasOptions {
  vbuId: string;
  autoSave?: boolean;
  debounceMs?: number;
}

interface UseCanvasReturn {
  canvas: Canvas | null;
  loading: boolean;
  error: string | null;
  saving: boolean;
  lastSaved: Date | null;
  updateCanvas: (updates: Partial<Canvas>) => Promise<void>;
  updateThesis: (thesisId: string, updates: Partial<Thesis>) => Promise<void>;
  reorderTheses: (thesisOrders: Array<{id: string, order: number}>) => Promise<void>;
  updateProofPoint: (proofPointId: string, updates: Partial<ProofPoint>) => Promise<void>;
  uploadAttachment: (proofPointId: string, file: File, label?: string) => Promise<void>;
  deleteAttachment: (attachmentId: string) => Promise<void>;
  setCurrentlyTesting: (type: 'thesis' | 'proof_point' | null, id: string | null) => Promise<void>;
}

const useCanvas = (options: UseCanvasOptions): UseCanvasReturn => {
  // Custom hook that manages canvas state and API integration
  // Provides autosave with 2s debounce
  // Handles optimistic updates for thesis reordering
  // Manages loading/error/saving states
  ...
}
```

## Logic
1. Import React hooks (useState, useEffect, useCallback, useRef)
2. Import canvas API client methods from T-023
3. Import Canvas, Thesis, ProofPoint types from T-022
4. Define UseCanvasOptions and UseCanvasReturn interfaces
5. Create useCanvas hook with options parameter
6. Add state for canvas data, loading, error, saving, lastSaved
7. Add useEffect to load canvas data on mount
8. Implement debounced autosave with useRef for timeout
9. Create updateCanvas function with autosave
10. Create updateThesis function with autosave
11. Create reorderTheses function with optimistic updates
12. Create updateProofPoint function with autosave
13. Create uploadAttachment function with progress handling
14. Create deleteAttachment function with optimistic removal
15. Create setCurrentlyTesting function with validation
16. Add error handling for all API calls
17. Return all state and functions from hook

## Verification
- [ ] Hook loads canvas data on mount
- [ ] Autosave triggers after 2s debounce
- [ ] Optimistic updates work for thesis reordering
- [ ] Loading states are managed correctly
- [ ] Error handling works for all operations
- [ ] File upload shows progress indication
- [ ] TypeScript types are complete
- [ ] Hook can be used by CanvasPage component

## LOC Estimate
~150 lines