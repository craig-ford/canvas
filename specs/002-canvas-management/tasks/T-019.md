# specs/002-canvas-management/tasks/T-019.md

## Task: CLI Commands

## Type
implementation

## Context
- **Phase**: Phase 5 - API Layer
- **Builds on**: T-012 (CanvasService Implementation), T-013 (AttachmentService Implementation)
- **Blocks**: None (final task in chain)

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-012 | backend/canvas/services/canvas_service.py | CanvasService class |
| T-013 | backend/canvas/services/attachment_service.py | AttachmentService class |

## Scope
- **CREATE**: `backend/canvas/cli.py`

## Contract
```python
import click
import json
import sys
from pathlib import Path
from uuid import UUID
from datetime import date

from canvas.services.canvas_service import CanvasService
from canvas.services.attachment_service import AttachmentService
from canvas.db import get_db_session

@click.group()
def canvas_cli():
    """Canvas management CLI commands."""
    ...

@canvas_cli.command()
@click.option("--name", required=True, help="VBU name")
@click.option("--gm-id", required=True, type=click.UUID, help="GM user ID")
def create_vbu(name: str, gm_id: UUID):
    """Create new VBU with canvas."""
    ...

@canvas_cli.command()
@click.option("--vbu-id", required=True, type=click.UUID, help="VBU ID")
def get_canvas(vbu_id: UUID):
    """Get canvas with all nested data."""
    ...

@canvas_cli.command()
@click.option("--canvas-id", required=True, type=click.UUID, help="Canvas ID")
@click.option("--text", required=True, help="Thesis text")
@click.option("--order", required=True, type=int, help="Display order 1-5")
def create_thesis(canvas_id: UUID, text: str, order: int):
    """Create thesis for canvas."""
    ...

@canvas_cli.command()
@click.option("--thesis-id", required=True, type=click.UUID, help="Thesis ID")
@click.option("--description", required=True, help="Proof point description")
@click.option("--status", default="not_started", help="Initial status")
def create_proof_point(thesis_id: UUID, description: str, status: str):
    """Create proof point for thesis."""
    ...

@canvas_cli.command()
@click.option("--file-path", required=True, type=click.Path(exists=True), help="File to upload")
@click.option("--proof-point-id", type=click.UUID, help="Proof point ID")
@click.option("--label", help="Optional file label")
@click.option("--uploaded-by", required=True, type=click.UUID, help="Uploader user ID")
def upload_file(file_path: Path, proof_point_id: UUID, label: str, uploaded_by: UUID):
    """Upload file attachment."""
    ...

if __name__ == "__main__":
    canvas_cli()
```

## Logic
1. Import CanvasService and AttachmentService from T-012, T-013
2. Import database session factory
3. Define click command group for canvas operations
4. Implement create_vbu - create VBU and associated canvas, output JSON
5. Implement get_canvas - fetch canvas with nested data, output JSON
6. Implement create_thesis - create thesis with validation, output JSON
7. Implement create_proof_point - create proof point, output JSON
8. Implement upload_file - upload file via AttachmentService, output JSON
9. All commands output JSON to stdout, errors to stderr
10. Use async database sessions within CLI commands

## Verification
- [ ] All commands output valid JSON to stdout
- [ ] Errors written to stderr with proper exit codes
- [ ] Database sessions properly managed (async context)
- [ ] File validation enforced in upload command
- [ ] Commands work with real database and filesystem
- [ ] Help text clear and accurate for all options

## LOC Estimate
~150 lines