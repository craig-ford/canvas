# specs/004-monthly-review/tasks/T-002.md

## Task: Commitment Model Contract

## Type
contract-test

## Context
- **Phase**: Contracts & Interfaces
- **Builds on**: T-001
- **Blocks**: T-003, T-004, T-005

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001A-infrastructure | backend/canvas/models/__init__.py | 001A-infrastructure/T-006 | `from canvas.models import Base, TimestampMixin` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| None | None | None |

## Scope
- **CREATE**: `backend/canvas/models/commitment.py`

## Contract
```python
from sqlalchemy import Column, Text, Integer, ForeignKey, Index, UniqueConstraint, CheckConstraint
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from canvas.models import Base, TimestampMixin

class Commitment(Base, TimestampMixin):
    __tablename__ = "commitments"
    
    monthly_review_id = Column(UUID(as_uuid=True), ForeignKey("monthly_reviews.id", ondelete="CASCADE"), nullable=False)
    text = Column(Text, nullable=False)
    order = Column(Integer, nullable=False)
    
    # Relationships
    monthly_review = relationship("MonthlyReview", back_populates="commitments")
    
    # Constraints
    __table_args__ = (
        CheckConstraint("length(text) > 0 AND length(text) <= 1000", name="ck_commitments_text_length"),
        CheckConstraint("order >= 1 AND order <= 3", name="ck_commitments_order_range"),
        UniqueConstraint('monthly_review_id', 'order', name='uq_commitments_review_order'),
        Index('ix_commitments_review_id', 'monthly_review_id'),
    )
```

## Logic
1. Import SQLAlchemy components and TimestampMixin
2. Define Commitment class inheriting Base and TimestampMixin
3. Add table name and columns with proper types
4. Define relationship to MonthlyReview
5. Add check constraints for text length (1-1000 chars) and order (1-3)
6. Add unique constraint on monthly_review_id + order
7. Add index on monthly_review_id for performance

## Verification
- [ ] Imports resolve without error
- [ ] Model has all required columns with correct types
- [ ] Relationship defined with proper back_populates
- [ ] Check constraints for text length and order range
- [ ] Unique constraint on monthly_review_id + order
- [ ] Index created for performance

## LOC Estimate
~25 lines