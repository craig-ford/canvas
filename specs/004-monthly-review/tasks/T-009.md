# specs/004-monthly-review/tasks/T-009.md

## Task: Commitment API Tests

## Type
integration-test

## Context
- **Phase**: Phase 2 - Test Infrastructure
- **Builds on**: T-004 (Pydantic schemas), T-007 (service integration tests)
- **Blocks**: T-010 (unit tests)
- **Requirements**: FR-005, FR-006

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-004 | backend/canvas/reviews/schemas.py | Pydantic validation schemas |
| T-007 | backend/tests/reviews/test_service_integration.py | Service test patterns |

## Scope
- **CREATE**: `backend/tests/reviews/test_commitment_validation.py`

## Contract
```python
import pytest
from httpx import AsyncClient
from fastapi import status
from datetime import date, timedelta

class TestCommitmentValidation:
    async def test_create_review_requires_1_to_3_commitments(self, client: AsyncClient, gm_token, canvas):
        """Test commitment count validation (1-3 required)"""
        
    async def test_commitment_text_length_validation(self, client: AsyncClient, gm_token, canvas):
        """Test commitment text must be 1-1000 characters"""
        
    async def test_commitment_order_uniqueness(self, client: AsyncClient, gm_token, canvas):
        """Test commitment orders must be unique within review"""
        
    async def test_commitment_order_range_validation(self, client: AsyncClient, gm_token, canvas):
        """Test commitment order must be 1-3"""
        
    async def test_review_date_not_future(self, client: AsyncClient, gm_token, canvas):
        """Test review_date cannot be in the future"""
        
    async def test_currently_testing_validation(self, client: AsyncClient, gm_token, canvas, other_canvas_thesis):
        """Test currently_testing_id must belong to canvas"""
        
    async def test_text_field_length_limits(self, client: AsyncClient, gm_token, canvas):
        """Test what_moved/learned/threatens max 5000 chars"""
        
    async def test_duplicate_review_date_conflict(self, client: AsyncClient, gm_token, canvas):
        """Test cannot create two reviews for same canvas and date"""
```

## Logic
1. Import HTTP client and validation schemas
2. Test commitment count validation (1-3 required)
3. Test commitment text length limits (1-1000 chars)
4. Test commitment order uniqueness and range
5. Test review date cannot be future
6. Test currently_testing belongs to canvas
7. Test text field length limits
8. Test duplicate date prevention

## Verification
- [ ] All test methods contain assert statements
- [ ] Validation error responses tested (422)
- [ ] Business rule violations tested
- [ ] Conflict scenarios tested (409)
- [ ] Field-level validation tested

## LOC Estimate
~90 lines