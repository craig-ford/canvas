# specs/004-monthly-review/tasks/T-012.md

## Task: Commitment Validation Tests

## Type
unit-test

## Context
- **Phase**: Phase 2 - Test Infrastructure
- **Builds on**: T-004 (Pydantic schemas)
- **Blocks**: T-013 (ReviewService implementation)
- **Requirements**: FR-003

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-004 | backend/canvas/reviews/schemas.py | Pydantic validation schemas |

## Scope
- **CREATE**: `backend/tests/schemas/test_commitment_validation.py`

## Contract
```python
import pytest
from pydantic import ValidationError
from uuid import uuid4
from datetime import date, timedelta
from canvas.reviews.schemas import CommitmentCreate, ReviewCreateSchema

class TestCommitmentValidation:
    def test_commitment_text_required(self):
        """Test commitment text is required"""
        with pytest.raises(ValidationError):
            CommitmentCreate(order=1)

    def test_commitment_text_length_limits(self):
        """Test commitment text 1-1000 character limits"""
        with pytest.raises(ValidationError):
            CommitmentCreate(text="", order=1)
        with pytest.raises(ValidationError):
            CommitmentCreate(text="x" * 1001, order=1)
        valid = CommitmentCreate(text="valid", order=1)
        assert valid.text == "valid"

    def test_commitment_order_range_validation(self):
        """Test commitment order must be 1-3"""
        with pytest.raises(ValidationError):
            CommitmentCreate(text="test", order=0)
        with pytest.raises(ValidationError):
            CommitmentCreate(text="test", order=4)

    def test_commitment_order_required(self):
        """Test commitment order is required"""
        with pytest.raises(ValidationError):
            CommitmentCreate(text="test")

    def test_review_commitments_count_validation(self):
        """Test review must have 1-3 commitments"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), commitments=[])
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), commitments=[CommitmentCreate(text=f"c{i}", order=i) for i in range(1, 5)])

    def test_review_commitments_unique_orders(self):
        """Test commitment orders must be unique within review"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), commitments=[CommitmentCreate(text="a", order=1), CommitmentCreate(text="b", order=1)])

    def test_review_date_not_future_validation(self):
        """Test review_date cannot be in the future"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today() + timedelta(days=1), commitments=[CommitmentCreate(text="c", order=1)])

    def test_currently_testing_type_enum_validation(self):
        """Test currently_testing_type must be 'thesis' or 'proof_point'"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), currently_testing_type="invalid", commitments=[CommitmentCreate(text="c", order=1)])

    def test_text_field_length_validation(self):
        """Test what_moved/learned/threatens max 5000 characters"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), what_moved="x" * 5001, commitments=[CommitmentCreate(text="c", order=1)])

    def test_attachment_ids_list_validation(self):
        """Test attachment_ids must be list of UUIDs, max 10 items"""
        with pytest.raises(ValidationError):
            ReviewCreateSchema(canvas_id=uuid4(), review_date=date.today(), attachment_ids=[uuid4() for _ in range(11)], commitments=[CommitmentCreate(text="c", order=1)])
```

## Logic
1. Import Pydantic schemas and validation utilities
2. Test CommitmentCreate validation rules
3. Test ReviewCreateSchema validation rules
4. Test text length limits for all fields
5. Test commitment count and order validation
6. Test enum validation for currently_testing_type
7. Test date validation rules
8. Test attachment_ids list validation

## Verification
- [ ] All test methods contain assert statements or pytest.raises
- [ ] ValidationError exceptions tested
- [ ] Field-level validation tested
- [ ] Cross-field validation tested
- [ ] Edge cases covered

## LOC Estimate
~70 lines