# specs/004-monthly-review/tasks/T-010.md

## Task: ReviewService Unit Tests

## Type
unit-test

## Context
- **Phase**: Phase 2 - Test Infrastructure
- **Builds on**: T-007 (ReviewService Integration Tests)
- **Blocks**: T-013 (ReviewService Implementation)
- **Requirements**: FR-001

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001-auth | backend/canvas/auth/dependencies.py | 001-auth/T-015 | `from canvas.auth.dependencies import get_current_user` |
| 002-canvas-management | backend/canvas/services/attachment_service.py | 002-canvas-management/T-013 | `from canvas.services.attachment_service import AttachmentService` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-007 | backend/canvas/reviews/service.py | ReviewService interface contract |

## Scope
- **CREATE**: `backend/tests/reviews/test_service_unit.py`

## Contract
```python
import pytest
from unittest.mock import AsyncMock, MagicMock
from uuid import uuid4
from datetime import date, datetime
from canvas.reviews.service import ReviewService
from canvas.models.monthly_review import MonthlyReview
from canvas.models.commitment import Commitment

class TestReviewServiceUnit:
    def test_list_reviews_query_construction(self):
        """Test list_reviews builds correct SQLAlchemy query"""
        assert True  # Query ordering and filtering logic
    
    def test_create_review_validation_logic(self):
        """Test create_review validates currently_testing selection"""
        assert True  # Business rule validation
    
    def test_get_review_not_found_handling(self):
        """Test get_review raises HTTPException for missing review"""
        assert True  # Error handling logic
    
    def test_validate_currently_testing_thesis_validation(self):
        """Test _validate_currently_testing for thesis selection"""
        assert True  # Thesis validation logic
    
    def test_validate_currently_testing_proof_point_validation(self):
        """Test _validate_currently_testing for proof point selection"""
        assert True  # Proof point validation logic
    
    def test_link_attachments_update_logic(self):
        """Test _link_attachments updates attachment records"""
        assert True  # Attachment linking logic
    
    def test_get_canvas_options_hierarchy_structure(self):
        """Test get_canvas_options returns hierarchical thesis/proof point structure"""
        assert True  # Data structure formatting
```

## Logic
1. Import ReviewService and mock dependencies (AsyncSession, HTTPException)
2. Create test class TestReviewServiceUnit with focused unit test methods
3. Test list_reviews query construction and ordering logic
4. Test create_review validation and business rules
5. Test get_review error handling for not found cases
6. Test _validate_currently_testing for both thesis and proof point validation
7. Test _link_attachments attachment update logic
8. Test get_canvas_options hierarchical data structure

## Verification
- [ ] All test methods contain assert statements or pytest.raises
- [ ] Tests focus on individual method logic without database calls
- [ ] Mock objects used for AsyncSession and external dependencies
- [ ] Test method names clearly describe what is being tested

## LOC Estimate
~80 lines