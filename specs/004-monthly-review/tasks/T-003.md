# specs/004-monthly-review/tasks/T-003.md

## Task: ReviewService Interface Contract

## Type
contract-test

## Context
- **Phase**: Contracts & Interfaces
- **Builds on**: T-001, T-002
- **Blocks**: T-007, T-008, T-009, T-010, T-013
- **Requirements**: FR-004

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 002-canvas-management | backend/canvas/models/canvas.py | 002-canvas-management/T-003 | `from canvas.models.canvas import Canvas` |
| 002-canvas-management | backend/canvas/models/thesis.py | 002-canvas-management/T-003 | `from canvas.models.thesis import Thesis` |
| 002-canvas-management | backend/canvas/models/proof_point.py | 002-canvas-management/T-003 | `from canvas.models.proof_point import ProofPoint` |
| 002-canvas-management | backend/canvas/models/attachment.py | 002-canvas-management/T-003 | `from canvas.models.attachment import Attachment` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-001 | backend/canvas/models/monthly_review.py | `from canvas.models.monthly_review import MonthlyReview` |
| T-002 | backend/canvas/models/commitment.py | `from canvas.models.commitment import Commitment` |

## Scope
- **CREATE**: `backend/canvas/reviews/service.py`

## Contract
```python
from typing import List, Dict, Any
from uuid import UUID
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, update
from sqlalchemy.orm import selectinload
from fastapi import HTTPException
from canvas.models.monthly_review import MonthlyReview
from canvas.models.commitment import Commitment
from canvas.models.canvas import Canvas
from canvas.models.thesis import Thesis
from canvas.models.proof_point import ProofPoint
from canvas.models.attachment import Attachment

class ReviewService:
    def __init__(self, db: AsyncSession):
        self.db = db
    
    async def list_reviews(self, canvas_id: UUID) -> List[MonthlyReview]:
        """List reviews for canvas, ordered by review_date DESC, created_at DESC"""
        ...
    
    async def create_review(self, canvas_id: UUID, review_data: Dict[str, Any], created_by: UUID) -> MonthlyReview:
        """Create review with commitments, update canvas currently_testing atomically"""
        ...
    
    async def get_review(self, review_id: UUID) -> MonthlyReview:
        """Get single review with commitments and attachments"""
        ...
        
    async def get_canvas_options(self, canvas_id: UUID) -> Dict[str, Any]:
        """Get theses and proof points for currently testing selection"""
        ...
    
    async def _validate_currently_testing(self, canvas_id: UUID, testing_type: str, testing_id: UUID) -> None:
        """Validate selected thesis/proof point belongs to canvas"""
        ...
    
    async def _link_attachments(self, review_id: UUID, attachment_ids: List[UUID]) -> None:
        """Link pre-uploaded attachments to review"""
        ...
```

## Logic
1. Import required types and SQLAlchemy components
2. Import model classes from T-001, T-002 and cross-feature dependencies
3. Define ReviewService class with AsyncSession dependency injection
4. Define public async methods with proper type hints
5. Define private helper methods for validation and attachment linking
6. Use ... for interface definitions (implementation in T-013)

## Verification
- [ ] Imports resolve without error
- [ ] All method signatures have proper type hints
- [ ] Public methods documented with docstrings
- [ ] Private helper methods defined for internal logic
- [ ] AsyncSession properly injected in constructor

## LOC Estimate
~40 lines