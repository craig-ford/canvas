# specs/004-monthly-review/tasks/T-015.md

## Task: Review Wizard UI

## Type
implementation

## Context
- **Phase**: Phase 6 - UI
- **Builds on**: T-014 (Review API routes)
- **Blocks**: T-017 (Auto-save functionality)
- **Requirements**: FR-001, FR-002, FR-003

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001A-infrastructure | frontend/src/api/client.ts | 001A-infrastructure/T-011 | `import { apiClient } from '../api/client'` |
| 002-canvas-management | frontend/src/components/FileUpload.tsx | 002-canvas-management/T-011 | `import { FileUpload } from '../components/FileUpload'` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-014 | backend/canvas/reviews/router.py | API endpoints for review operations |

## Scope
- **CREATE**: `frontend/src/reviews/ReviewWizard.tsx`
- **CREATE**: `frontend/src/reviews/components/StepIndicator.tsx`
- **CREATE**: `frontend/src/reviews/components/WhatMovedStep.tsx`
- **CREATE**: `frontend/src/reviews/components/CommitmentsStep.tsx`

## Contract
```typescript
// ReviewWizard.tsx
import React, { useState, useEffect } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { apiClient } from '../api/client'
import { StepIndicator } from './components/StepIndicator'
import { WhatMovedStep } from './components/WhatMovedStep'
import { CommitmentsStep } from './components/CommitmentsStep'

interface ReviewData {
  what_moved: string
  what_learned: string
  what_threatens: string
  currently_testing_type: 'thesis' | 'proof_point'
  currently_testing_id: string
  commitments: Array<{ text: string; order: number }>
  attachment_ids: string[]
}

export const ReviewWizard: React.FC = () => {
  const { vbuId } = useParams<{ vbuId: string }>()
  const navigate = useNavigate()
  const [currentStep, setCurrentStep] = useState(1)
  const [reviewData, setReviewData] = useState<ReviewData>({...})
  const [canvasOptions, setCanvasOptions] = useState<any>(null)
  
  const handleNext = () => {...}
  const handlePrevious = () => {...}
  const handleSubmit = async () => {...}
  
  return (
    <div className="max-w-4xl mx-auto p-6">
      <StepIndicator currentStep={currentStep} totalSteps={4} />
      {currentStep === 1 && <WhatMovedStep data={reviewData} onChange={setReviewData} />}
      {currentStep === 4 && <CommitmentsStep data={reviewData} onChange={setReviewData} options={canvasOptions} />}
    </div>
  )
}

// StepIndicator.tsx
interface StepIndicatorProps {
  currentStep: number
  totalSteps: number
}

export const StepIndicator: React.FC<StepIndicatorProps> = ({ currentStep, totalSteps }) => {
  return (
    <div className="flex items-center justify-center mb-8">
      {Array.from({ length: totalSteps }, (_, i) => i + 1).map(step => (
        <div key={step} className="flex items-center">
          <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
            step <= currentStep ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'
          }`}>
            {step}
          </div>
          {step < totalSteps && <div className="w-12 h-0.5 bg-gray-300 mx-2" />}
        </div>
      ))}
    </div>
  )
}

// WhatMovedStep.tsx
interface WhatMovedStepProps {
  data: ReviewData
  onChange: (data: ReviewData) => void
}

export const WhatMovedStep: React.FC<WhatMovedStepProps> = ({ data, onChange }) => {
  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-semibold">What moved since last month?</h2>
      <textarea
        value={data.what_moved}
        onChange={(e) => onChange({ ...data, what_moved: e.target.value })}
        className="w-full h-32 p-4 border rounded-lg"
        maxLength={5000}
        placeholder="Focus on measurable outcomes, customer feedback, and concrete progress..."
      />
      <div className="text-sm text-gray-500">{data.what_moved.length}/5000 characters</div>
    </div>
  )
}

// CommitmentsStep.tsx
interface CommitmentsStepProps {
  data: ReviewData
  onChange: (data: ReviewData) => void
  options: any
}

export const CommitmentsStep: React.FC<CommitmentsStepProps> = ({ data, onChange, options }) => {
  const addCommitment = () => {...}
  const removeCommitment = (index: number) => {...}
  
  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-medium mb-4">Commitments (1-3 required)</h3>
        {data.commitments.map((commitment, index) => (
          <div key={index} className="flex items-center space-x-2 mb-2">
            <span>{index + 1}.</span>
            <input
              value={commitment.text}
              onChange={(e) => {...}}
              className="flex-1 p-2 border rounded"
              maxLength={1000}
            />
            <button onClick={() => removeCommitment(index)}>Ã—</button>
          </div>
        ))}
        {data.commitments.length < 3 && (
          <button onClick={addCommitment} className="text-blue-600">+ Add Commitment</button>
        )}
      </div>
      
      <div>
        <h3 className="text-lg font-medium mb-4">What are we currently testing?</h3>
        <div className="space-y-2">
          {options?.theses?.map((thesis: any) => (
            <div key={thesis.id}>
              <label className="flex items-center">
                <input
                  type="radio"
                  name="currently_testing"
                  value={`thesis:${thesis.id}`}
                  onChange={() => {...}}
                />
                <span className="ml-2">{thesis.text}</span>
              </label>
              {thesis.proof_points?.map((pp: any) => (
                <label key={pp.id} className="flex items-center ml-6">
                  <input
                    type="radio"
                    name="currently_testing"
                    value={`proof_point:${pp.id}`}
                    onChange={() => {...}}
                  />
                  <span className="ml-2">{pp.description}</span>
                </label>
              ))}
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}
```

## Logic
1. Create ReviewWizard main component with step navigation state
2. Implement StepIndicator with visual progress circles
3. Create WhatMovedStep with textarea and character counting
4. Create similar steps for WhatLearned and WhatThreatens
5. Create CommitmentsStep with dynamic commitment management
6. Add currently testing selection with hierarchical radio buttons
7. Implement form validation and navigation controls
8. Add API integration for canvas options and review submission

## Verification
- [ ] All components use TypeScript with proper interfaces
- [ ] Form validation prevents invalid submissions
- [ ] Step navigation works with Previous/Next buttons
- [ ] Character limits enforced on text inputs
- [ ] Currently testing selection shows hierarchical structure

## LOC Estimate
~300 lines