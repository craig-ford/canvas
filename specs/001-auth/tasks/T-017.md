# specs/001-auth/tasks/T-017.md

## Task: useAuth Hook Implementation

- **Type**: implementation
- **Requirements**: FR-AUTH-001, FR-AUTH-002
- **Context**: Implements the useAuth React hook defined in 001-auth spec.md UI Components section. This hook provides authentication state and actions (login, logout, refreshToken) to all frontend components. Used by 003-portfolio-dashboard and other features for role-based rendering and auth state management.

## Scope

- **CREATE**: `frontend/src/auth/useAuth.ts`
- **CREATE**: `frontend/src/auth/AuthContext.tsx`

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001A-infrastructure | frontend/src/api/client.ts | 001A-infrastructure/T-011 | `import { api } from '../api/client'` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| T-016 | backend/canvas/auth/routes.py | API endpoint definitions for login/logout/refresh |

## Contract

```typescript
// frontend/src/auth/useAuth.ts
import { createContext, useContext, useState, useCallback, useEffect, ReactNode } from 'react';
import { api } from '../api/client';

interface User {
  id: string;
  email: string;
  full_name: string;
  role: 'admin' | 'gm' | 'viewer';
  is_active: boolean;
}

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
}

interface AuthActions {
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<void>;
}

type AuthContextType = AuthState & AuthActions;

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }): JSX.Element;
export function useAuth(): AuthContextType;
```

## Logic

1. Create `frontend/src/auth/AuthContext.tsx`:
   - Define AuthContext with createContext
   - Implement AuthProvider component that manages auth state
   - Store access token in memory, refresh token in httpOnly cookie (handled by backend)
   - On mount, attempt token refresh to restore session
   - Provide login function that calls `POST /api/auth/login` and stores user
   - Provide logout function that calls `POST /api/auth/logout` and clears state
   - Provide refreshToken function that calls `POST /api/auth/refresh`
   - Set isLoading=true during initial session restore, false after

2. Create `frontend/src/auth/useAuth.ts`:
   - Export useAuth hook that calls useContext(AuthContext)
   - Throw error if used outside AuthProvider
   - Re-export AuthProvider for convenience

## Constraints

- **MUST reuse**: API client from 001A-infrastructure/T-011
- **MUST NOT**: Store tokens in localStorage (security requirement from spec)
- **LOC estimate**: ~120 lines total

## Verification

- [ ] `frontend/src/auth/useAuth.ts` exports useAuth hook
- [ ] `frontend/src/auth/AuthContext.tsx` exports AuthProvider
- [ ] Login calls POST /api/auth/login
- [ ] Logout calls POST /api/auth/logout
- [ ] Token refresh calls POST /api/auth/refresh
- [ ] No localStorage token storage
- [ ] No pass, TODO, FIXME, or NotImplementedError
