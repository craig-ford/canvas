# specs/001-auth/tasks/T-001.md

## Task: User Model Contract Tests

## Type
contract-test

## Context
- **Phase**: Contracts & Interfaces
- **Builds on**: None
- **Blocks**: T-002, T-003, T-008

## Predecessors

### Cross-Feature
| Feature | File | Task | Import Statement |
|---------|------|------|------------------|
| 001A-infrastructure | backend/canvas/models/__init__.py | 001A-infrastructure/T-006 | `from canvas.models.base import TimestampMixin` |

### Within Feature
| Task | File | What This Task Imports |
|------|------|------------------------|
| None | | |

## Scope
- **CREATE**: `backend/canvas/models/user.py`
- **CREATE**: `backend/tests/models/test_user_contract.py`

## Contract
```python
from enum import Enum
from sqlalchemy import Column, String, Enum as SQLEnum, Boolean, Integer, DateTime
from sqlalchemy.dialects.postgresql import UUID
from canvas.models.base import TimestampMixin, Base

class UserRole(str, Enum):
    ADMIN = "admin"
    GM = "gm" 
    VIEWER = "viewer"

class User(Base, TimestampMixin):
    __tablename__ = "users"
    
    email = Column(String(255), unique=True, nullable=False, index=True)
    password_hash = Column(String(255), nullable=False)
    name = Column(String(255), nullable=False)
    role = Column(SQLEnum(UserRole), nullable=False, default=UserRole.VIEWER)
    is_active = Column(Boolean, nullable=False, default=True)
    last_login_at = Column(DateTime(timezone=True), nullable=True)
    failed_login_attempts = Column(Integer, nullable=False, default=0)
    locked_until = Column(DateTime(timezone=True), nullable=True)
```

## Logic
1. Import TimestampMixin from base models
2. Define UserRole enum with admin/gm/viewer values
3. Define User SQLAlchemy model with all required fields
4. Set table name to "users"
5. Add email unique constraint and index
6. Set default values for role, is_active, failed_login_attempts
7. Write contract tests verifying model structure and constraints

## Verification
- [ ] User model imports without error
- [ ] UserRole enum has correct values
- [ ] All columns defined with proper types and constraints
- [ ] TimestampMixin inherited correctly
- [ ] Contract tests pass

## LOC Estimate
~80 lines